---
- name: Include Eco Vcenter Test Vars
  ansible.builtin.include_vars:
    file: eco-vcenter.yml
  tags: eco-vcenter-ci

- name: Include Test Tasks
  block:
    - name: Include Test Tasks
      ansible.builtin.include_tasks:
        file: test.yml
        apply:
          tags: eco-vcenter-ci, integration-ci
      tags: eco-vcenter-ci, integration-ci
  always:
    - name: Destroy Test Folder
      vmware.vmware.folder:
        validate_certs: false
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        datacenter: "{{ vcenter_datacenter }}"
        port: "{{ vcenter_port }}"
        relative_path: "{{ test_folder | split('/') | first }}"
        folder_type: "{{ vmware_folder_type }}"
        state: absent
      when: not run_on_simulator
      tags: eco-vcenter-ci
