---
- name: Include Eco Vcenter Test Vars
  ansible.builtin.include_vars:
    file: eco-vcenter.yml
  tags: eco-vcenter-ci

- name: Include Test Tasks
  environment:
    VMWARE_HOST: "{{ vcenter_hostname }}"
    VMWARE_USER: "{{ vcenter_username }}"
    VMWARE_PASSWORD: "{{ vcenter_password }}"
    VMWARE_VALIDATE_CERTS: "False"
    VMWARE_PORT: "{{ vcenter_port }}"

  block:
    - name: Include Test Tasks
      ansible.builtin.include_tasks:
        file: test.yml
  always:
    - name: Destroy Test Folder
      vmware.vmware.folder:
        datacenter: "{{ vcenter_datacenter }}"
        relative_path: "{{ test_folder | split('/') | first }}"
        folder_type: "{{ vmware_folder_type }}"
        state: absent
      when: run_on_vcenter
