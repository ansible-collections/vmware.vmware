---
- name: Test
  environment:
    VMWARE_HOST: "{{ vcenter_hostname }}"
    VMWARE_USER: "{{ vcenter_username }}"
    VMWARE_PASSWORD: "{{ vcenter_password }}"
    VMWARE_VALIDATE_CERTS: "False"
    VMWARE_PORT: "{{ vcenter_port }}"
  block:
    - name: Set Host Maintenance Mode
      vmware.vmware.esxi_maintenance_mode:
        enable_maintenance_mode: True
        name: "{{ test_esxi_hostname }}"
      register: _set
    - name: Check Task Output
      ansible.builtin.assert:
        that:
          - _set is changed

    - name: Set Host Maintenance Mode Again
      vmware.vmware.esxi_maintenance_mode:
        enable_maintenance_mode: True
        name: "{{ test_esxi_hostname }}"
      register: _set
    - name: Check Task Output
      ansible.builtin.assert:
        that:
          - _set is not changed

    - name: Unset Host Maintenance Mode
      vmware.vmware.esxi_maintenance_mode:
        enable_maintenance_mode: False
        name: "{{ test_esxi_hostname }}"
      register: _set
    - name: Check Task Output
      ansible.builtin.assert:
        that:
          - _set is changed

    - name: Unset Host Maintenance Mode Again
      vmware.vmware.esxi_maintenance_mode:
        enable_maintenance_mode: False
        name: "{{ test_esxi_hostname }}"
      register: _set
    - name: Check Task Output
      ansible.builtin.assert:
        that:
          - _set is not changed
