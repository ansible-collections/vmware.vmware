---
####
# Catch all query
####
vmware.vmware.*:
  query: >-
    (
      {"vm": "VM", "host": "ESXi", "vcsa": "vCenter Appliance", "cluster": "Cluster"} as $mapping |
      (if (keys | length) == 1 then .[(keys | first)] else . end) as $data |
      (
        ($data | ($mapping | keys) | first)
      ) as $node_type |
      select($node_type != null) |
      {
        name: $data[$node_type].moid,
        canonical_facts: {
          name: $data[$node_type].name,
          id: $data[$node_type].moid,
          node_type: $node_type
        },
        facts: {
          device_type: ($mapping[$node_type] // "UNKNOWN")
        }
      }
    )
